"use strict";(self.webpackChunklearning_notes=self.webpackChunklearning_notes||[]).push([[3144],{71778:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>s,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var r=t(85893),i=t(11151);const o={title:"Serve Static Website Stored On Remote Server Using Nginx",authors:"xiaohai",tags:["docker","object storage","nginx"]},s=void 0,a={permalink:"/blog/2023/03/18/serve-static-site-with-nginx",editUrl:"https://github.com/xiaohai-huang/learning-notes/tree/master/blog/2023/03-18-serve-static-site-with-nginx/index.md",source:"@site/blog/2023/03-18-serve-static-site-with-nginx/index.md",title:"Serve Static Website Stored On Remote Server Using Nginx",description:"I stored the build folder of react app on my MiniO server under the path https://storage.xiaohai-huang.net/website/build/index.html. I want to serve the web app using a custom domain pxd.pink. Here is how I achieve this with the help of Nginx.",date:"2023-03-18T00:00:00.000Z",formattedDate:"18 March 2023",tags:[{label:"docker",permalink:"/blog/tags/docker"},{label:"object storage",permalink:"/blog/tags/object-storage"},{label:"nginx",permalink:"/blog/tags/nginx"}],readingTime:1.865,hasTruncateMarker:!0,authors:[{name:"Xiaohai Huang",title:"CS Student",url:"http://github.com/xiaohai-huang",imageURL:"https://github.com/xiaohai-huang.png",key:"xiaohai"}],frontMatter:{title:"Serve Static Website Stored On Remote Server Using Nginx",authors:"xiaohai",tags:["docker","object storage","nginx"]},unlisted:!1,prevItem:{title:"Perform In-Game Updates in Unity using HybridCLR and Addressables",permalink:"/blog/2023/03/25/unity-hot-update"},nextItem:{title:"Host a MinIO Server with Nginx as Reverse Proxy",permalink:"/blog/2023/03/15/host-minio-server"}},h={authorsImageUrls:[void 0]},c=[{value:"Setup Nginx Proxy Manager",id:"setup-nginx-proxy-manager",level:2},{value:"Redirect Domain to Subpath",id:"redirect-domain-to-subpath",level:2},{value:"Expose the Storage Service",id:"expose-the-storage-service",level:2},{value:"References",id:"references",level:2}];function d(e){const n=Object.assign({p:"p",code:"code",h2:"h2",a:"a",strong:"strong",ol:"ol",li:"li",pre:"pre",ul:"ul"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["I stored the ",(0,r.jsx)(n.code,{children:"build"})," folder of react app on my MiniO server under the path ",(0,r.jsx)(n.code,{children:"https://storage.xiaohai-huang.net/website/build/index.html"}),". I want to serve the web app using a custom domain ",(0,r.jsx)(n.code,{children:"pxd.pink"}),". Here is how I achieve this with the help of Nginx."]}),"\n",(0,r.jsx)(n.h2,{id:"setup-nginx-proxy-manager",children:"Setup Nginx Proxy Manager"}),"\n",(0,r.jsxs)(n.p,{children:["Use the Docker to setup the ",(0,r.jsx)(n.a,{href:"https://github.com/NginxProxyManager/nginx-proxy-manager",children:(0,r.jsx)(n.strong,{children:"Nginx Proxy Manager"})}),"."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create a Docker network"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Create a Docker network for the Nginx server and the upstream services. So they can communicate with each other and the services do not need to expose/publish ports to the host."}),"\n",(0,r.jsxs)(n.p,{children:['Create a network, e.g., "',(0,r.jsx)(n.code,{children:"nginx-network"}),'"']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker network create nginx-network\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then add the following to the bottom of the ",(0,r.jsx)(n.code,{children:"docker-compose.yaml"})," of the Nginx Proxy Manager and any other services that need to use the reverse proxy server."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yaml"',children:"networks:\n  nginx-network-alias:\n    name: nginx-network\n    external: true\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Launch the Nginx Proxy Manager"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"docker-compose.yaml"}),". And ",(0,r.jsx)(n.code,{children:"docker-compose up -d"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yaml"',children:'version: "3"\nservices:\n  app:\n    image: "jc21/nginx-proxy-manager:latest"\n    restart: unless-stopped\n    ports:\n      - "80:80"\n      - "81:81"\n      - "443:443"\n    volumes:\n      - ./data:/data\n      - /etc/letsencrypt:/etc/letsencrypt\n\n// highlight-start\n# connect to the same network\n    networks:\n      - reverse-proxy-network\n// highlight-end\n\n// highlight-start\nnetworks:\n  reverse-proxy-network:\n    external: true\n    name: nginx-network\n// highlight-end\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"redirect-domain-to-subpath",children:"Redirect Domain to Subpath"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:['domain: "',(0,r.jsx)(n.a,{href:"https://pxd.pink",children:"pxd.pink"}),'"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"build"}),' folder location: "',(0,r.jsx)(n.a,{href:"https://storage.xiaohai-huang.net/website/build/",children:"https://storage.xiaohai-huang.net/website/build/"}),'"']}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Write the following config in the ",(0,r.jsx)(n.code,{children:"Advanced tab"})," of the ",(0,r.jsx)(n.code,{children:"Edit Proxy Host"})," menu."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"location / {\n    proxy_intercept_errors on;\n    error_page 404 = /index.html;\n    proxy_pass http://my-minio-server:9000/website/xiaohai-test-site/dist/;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The above config makes the Nginx server to return ",(0,r.jsx)(n.code,{children:"/index.html"})," on the storage server if the storage server cannot find the specified object in its bucket. This is necessary in order to make react-router function properly."]}),"\n",(0,r.jsx)(n.h2,{id:"expose-the-storage-service",children:"Expose the Storage Service"}),"\n",(0,r.jsx)(n.p,{children:"Let's look at how to expose the storage service to the world."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yaml"',children:"version: \"3\"\nservices:\n  minio-service:\n    hostname: my-minio-server\n    image: minio/minio\n    restart: always\n    command: server /data --address ':9000' --console-address ':9001'\n    environment:\n      MINIO_ACCESS_KEY: admin\n      MINIO_SECRET_KEY: hello-world\n      MINIO_SERVER_URL: https://storage.xiaohai-huang.net\n      MINIO_BROWSER_REDIRECT_URL: https://storage.xiaohai-huang.net/minio-console\n    ports:\n      - 9000\n      - 9001\n    volumes:\n      - minio-data:/data\n\n// highlight-start\n# connect to the same network\n    networks:\n      - nginx-network-alias\n// highlight-end\n\n// highlight-start\nnetworks:\n  nginx-network-alias:\n    name: nginx-network\n    external: true\n// highlight-end\n\n\nvolumes:\n  minio-data:\n    driver_opts:\n      type: none # stands for bind mount\n      device: /docker/minio\n      o: bind\n"})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://nginxproxymanager.com/advanced-config/#best-practice-use-a-docker-network",children:"NPM | Advanced Configuration"})}),"\n"]})]})}const l=function(e={}){const{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,Object.assign({},e,{children:(0,r.jsx)(d,e)})):d(e)}},11151:(e,n,t)=>{t.d(n,{Zo:()=>a,ah:()=>o});var r=t(67294);const i=r.createContext({});function o(e){const n=r.useContext(i);return r.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const s={};function a({components:e,children:n,disableParentContext:t}){let a;return a=t?"function"==typeof e?e({}):e||s:o(e),r.createElement(i.Provider,{value:a},n)}}}]);