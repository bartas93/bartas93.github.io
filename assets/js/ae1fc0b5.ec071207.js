"use strict";(self.webpackChunklearning_notes=self.webpackChunklearning_notes||[]).push([[44],{75179:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var r=t(85893),i=t(11151);const o={title:"Host a MinIO Server with Nginx as Reverse Proxy",authors:"xiaohai",tags:["docker","object storage"]},s=void 0,a={permalink:"/blog/2023/03/15/host-minio-server",editUrl:"https://github.com/xiaohai-huang/learning-notes/tree/master/blog/2023/03-15-host-minio-server/index.md",source:"@site/blog/2023/03-15-host-minio-server/index.md",title:"Host a MinIO Server with Nginx as Reverse Proxy",description:"This documentation covers the minimum settings required to configure NGINX to proxy requests to MinIO.",date:"2023-03-15T00:00:00.000Z",formattedDate:"15 March 2023",tags:[{label:"docker",permalink:"/blog/tags/docker"},{label:"object storage",permalink:"/blog/tags/object-storage"}],readingTime:1.935,hasTruncateMarker:!0,authors:[{name:"Xiaohai Huang",title:"CS Student",url:"http://github.com/xiaohai-huang",imageURL:"https://github.com/xiaohai-huang.png",key:"xiaohai"}],frontMatter:{title:"Host a MinIO Server with Nginx as Reverse Proxy",authors:"xiaohai",tags:["docker","object storage"]},unlisted:!1,prevItem:{title:"Serve Static Website Stored On Remote Server Using Nginx",permalink:"/blog/2023/03/18/serve-static-site-with-nginx"},nextItem:{title:"Alibaba Beijing Interview Round 1",permalink:"/blog/2022/12/08/alibaba-interview-round-1"}},c={authorsImageUrls:[void 0]},d=[{value:"Get Certificates",id:"get-certificates",level:2},{value:"Servers Configurations",id:"servers-configurations",level:2},{value:"Docker Compose File",id:"docker-compose-file",level:3},{value:"Nginx Configuration",id:"nginx-configuration",level:3},{value:"References",id:"references",level:2}];function h(e){const n=Object.assign({p:"p",code:"code",ul:"ul",li:"li",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",admonition:"admonition",h2:"h2",pre:"pre",h3:"h3",a:"a"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This documentation covers the minimum settings required to configure NGINX to proxy requests to MinIO."}),"\n",(0,r.jsxs)(n.p,{children:["Given domain ",(0,r.jsx)(n.code,{children:"storage.xiaohai-huang.net"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Proxy requests to ",(0,r.jsx)(n.code,{children:"https://storage.xiaohai-huang.net"})," to the MinIO S3 API server listening on ",(0,r.jsx)(n.code,{children:"http://my-minio-server:9000"})]}),"\n",(0,r.jsxs)(n.li,{children:["Proxy requests to the subpath (",(0,r.jsx)(n.code,{children:"/minio-console"}),") of the domain ",(0,r.jsx)(n.code,{children:"https://storage.xiaohai-huang.net/minio-console"})," to the MinIO Web Console listening on ",(0,r.jsx)(n.code,{children:"http://my-minio-server:9001"})]}),"\n"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Host"}),(0,r.jsx)(n.th,{children:"Container"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://storage.xiaohai-huang.net"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"http://my-minio-server:9000"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://storage.xiaohai-huang.net/minio-console"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"http://my-minio-server:9001"})})]})]})]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"my-minio-server"})," is defined in ",(0,r.jsx)(n.code,{children:"docker-compose.yaml"})," by ",(0,r.jsx)(n.code,{children:"hostname"}),". This allows nginx to access it using hostname rather than IP."]}),(0,r.jsxs)(n.p,{children:["i.e. ",(0,r.jsx)(n.code,{children:"proxy_pass http://my-minio-server:9000/;"})]})]}),"\n",(0,r.jsx)(n.h2,{id:"get-certificates",children:"Get Certificates"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"certbot"})," to generate TLS certificates."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker run -it --rm --name certbot \\\n      -p 80:80 -p 443:443 \\\n      -v "/etc/letsencrypt:/etc/letsencrypt" \\\n      certbot/certbot certonly --standalone -d storage.xiaohai-huang.net\n'})}),"\n",(0,r.jsx)(n.h2,{id:"servers-configurations",children:"Servers Configurations"}),"\n",(0,r.jsx)(n.p,{children:"Things to change:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MINIO_ACCESS_KEY"}),", ",(0,r.jsx)(n.code,{children:"MINIO_SECRET_KEY"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MINIO_SERVER_URL"})," used by Web Console to correctly generate share URL."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MINIO_BROWSER_REDIRECT_URL"})," used by Web Console to redireact correctly even if it is behind a proxy."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"docker-compose-file",children:"Docker Compose File"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yaml"',children:'version: "3"\nservices:\n  minio-service:\n    hostname: my-minio-server\n    image: minio/minio\n    restart: always\n    command: server /data --address \':9000\' --console-address \':9001\'\n    environment:\n      MINIO_ACCESS_KEY: <user-name>\n      MINIO_SECRET_KEY: <password>\n      MINIO_SERVER_URL: https://storage.xiaohai-huang.net\n      MINIO_BROWSER_REDIRECT_URL: https://storage.xiaohai-huang.net/minio-console\n    ports:\n      - 9000\n      - 9001\n    volumes:\n      - minio-data:/data\n    networks:\n      - minio-net\n\n  nginx:\n    image: nginx\n    restart: always\n    ports:\n      - "80:80"\n      - "443:443"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf\n      - /etc/letsencrypt:/etc/letsencrypt\n    depends_on:\n      - minio-service\n    networks:\n      - minio-net\n\nnetworks:\n  minio-net:\n\nvolumes:\n  minio-data:\n    driver_opts:\n      type: none # stands for bind mount\n      device: /docker/minio\n      o: bind\n'})}),"\n",(0,r.jsx)(n.h3,{id:"nginx-configuration",children:"Nginx Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",metastring:'title="nginx.conf"',children:'events {}\n\nhttp {\n  server {\n    listen 80;\n    server_name storage.xiaohai-huang.net;\n    return 301 https://$host$request_uri;\n  }\n\n  server {\n    listen 443 ssl;\n    server_name storage.xiaohai-huang.net;\n\n    ssl_certificate /etc/letsencrypt/live/storage.xiaohai-huang.net/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/storage.xiaohai-huang.net/privkey.pem;\n\n    location / {\n      proxy_set_header Host $http_host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header X-Forwarded-Proto $scheme;\n\n      proxy_connect_timeout 300;\n      # Default is HTTP/1, keepalive is only enabled in HTTP/1.1\n      proxy_http_version 1.1;\n      proxy_set_header Connection "";\n      chunked_transfer_encoding off;\n\n      proxy_pass http://my-minio-server:9000/;\n    }\n\n    location /minio-console/ {\n      proxy_set_header Host $http_host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header X-Forwarded-Proto $scheme;\n      proxy_set_header X-NginX-Proxy true;\n\n      # This is necessary to pass the correct IP to be hashed\n      real_ip_header X-Real-IP;\n\n      proxy_connect_timeout 300;\n\n      # To support websockets in MinIO versions released after January 2023\n      proxy_http_version 1.1;\n      proxy_set_header Upgrade $http_upgrade;\n      proxy_set_header Connection "upgrade";\n\n      chunked_transfer_encoding off;\n\n    #   rewrite   ^/minio-console/(.*) /$1 break;\n      proxy_pass http://my-minio-server:9001/;\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://min.io/docs/minio/linux/integrations/setup-nginx-proxy-with-minio.html",children:"Configure NGINX Proxy for MinIO Server"})}),"\n"]})]})}const l=function(e={}){const{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,Object.assign({},e,{children:(0,r.jsx)(h,e)})):h(e)}},11151:(e,n,t)=>{t.d(n,{Zo:()=>a,ah:()=>o});var r=t(67294);const i=r.createContext({});function o(e){const n=r.useContext(i);return r.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const s={};function a({components:e,children:n,disableParentContext:t}){let a;return a=t?"function"==typeof e?e({}):e||s:o(e),r.createElement(i.Provider,{value:a},n)}}}]);