"use strict";(self.webpackChunklearning_notes=self.webpackChunklearning_notes||[]).push([[3548],{77140:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>l,contentTitle:()=>r,default:()=>a,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var n=s(85893),c=s(11151);const t={sidebar_label:"Content Security Policy",description:"Notes about HTTP response header Content-Security-Policy which can be used to prevent cross-site scripting attacks."},r="Content Security Policy (CSP)",o={id:"Web/Network/HTTP/content-security-policy",title:"Content Security Policy (CSP)",description:"Notes about HTTP response header Content-Security-Policy which can be used to prevent cross-site scripting attacks.",source:"@site/docs/Web/Network/HTTP/content-security-policy.md",sourceDirName:"Web/Network/HTTP",slug:"/Web/Network/HTTP/content-security-policy",permalink:"/docs/Web/Network/HTTP/content-security-policy",draft:!1,unlisted:!1,editUrl:"https://github.com/xiaohai-huang/learning-notes/tree/master/docs/Web/Network/HTTP/content-security-policy.md",tags:[],version:"current",lastUpdatedBy:"xiaohai-huang",lastUpdatedAt:1671087135,formattedLastUpdatedAt:"15 Dec 2022",frontMatter:{sidebar_label:"Content Security Policy",description:"Notes about HTTP response header Content-Security-Policy which can be used to prevent cross-site scripting attacks."},sidebar:"notesSidebar",previous:{title:"Cache",permalink:"/docs/Web/Network/HTTP/cache"},next:{title:"Cookies",permalink:"/docs/Web/Network/HTTP/cookies"}},l={},d=[{value:"Using CSP",id:"using-csp",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Fetch Directives",id:"fetch-directives",level:3},{value:"<code>default-src</code>",id:"default-src",level:4},{value:"<code>script-src</code>",id:"script-src",level:4},{value:"<code>font-src</code>",id:"font-src",level:4},{value:"<code>img-src</code>",id:"img-src",level:4},{value:"<code>style-src</code>",id:"style-src",level:4},{value:"Navigation Directives",id:"navigation-directives",level:3},{value:"<code>form-action</code>",id:"form-action",level:4},{value:"<code>navigate-to</code>",id:"navigate-to",level:4},{value:"Reporting Directives",id:"reporting-directives",level:3},{value:"<code>report-uri</code>",id:"report-uri",level:4},{value:"<code>report-to</code>",id:"report-to",level:4},{value:"Other Directives",id:"other-directives",level:3},{value:"<code>trusted-types</code>",id:"trusted-types",level:4},{value:"<code>upgrade-insecure-requests</code>",id:"upgrade-insecure-requests",level:4},{value:"Values",id:"values",level:3},{value:"\ud83d\udd11 Keyword Values",id:"-keyword-values",level:4},{value:"<code>none</code>",id:"none",level:5},{value:"<code>self</code>",id:"self",level:5},{value:"<code>strict-dynamic</code>",id:"strict-dynamic",level:5},{value:"\ud83d\udd17 Hosts Values",id:"-hosts-values",level:4},{value:"Host",id:"host",level:5},{value:"Scheme",id:"scheme",level:5},{value:"\ud83d\udc7d\ufe0f Other Values",id:"\ufe0f-other-values",level:4},{value:"Injection Defense",id:"injection-defense",level:2},{value:"Nonce-Based CSP",id:"nonce-based-csp",level:3},{value:"Trusted Types",id:"trusted-types-1",level:3},{value:"References",id:"references",level:2}];function h(e){const i=Object.assign({h1:"h1",p:"p",code:"code",strong:"strong",admonition:"admonition",h2:"h2",ol:"ol",li:"li",pre:"pre",h3:"h3",h4:"h4",h5:"h5",ul:"ul",a:"a",em:"em"},(0,c.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"content-security-policy-csp",children:"Content Security Policy (CSP)"}),"\n",(0,n.jsxs)(i.p,{children:["The HTTP ",(0,n.jsx)(i.code,{children:"Content-Security-Policy"})," response header allows website owners to decide which resources the user agent is allowed to load for a given page. This helps guard against ",(0,n.jsx)(i.strong,{children:"cross-site scripting"})," attacks."]}),"\n",(0,n.jsx)(i.admonition,{type:"info",children:(0,n.jsx)(i.p,{children:"A primary goal of CSP is to mitigate and report XSS attacks."})}),"\n",(0,n.jsx)(i.h2,{id:"using-csp",children:"Using CSP"}),"\n",(0,n.jsx)(i.p,{children:"There are two ways to configure content security policy."}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"HTTP response header"}),"\n",(0,n.jsx)(i.li,{children:"meta tag"}),"\n"]}),"\n",(0,n.jsx)(i.admonition,{type:"note",children:(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-html",children:"<meta\n  http-equiv=\"Content-Security-Policy\"\n  content=\"default-src 'self'; img-src https://*; child-src 'none';\"\n/>\n"})})}),"\n",(0,n.jsx)(i.h2,{id:"syntax",children:"Syntax"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"Content-Security-Policy: <policy-directive>; <policy-directive>\n"})}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"<policy-directive>"})," consists of ",(0,n.jsx)(i.code,{children:"<directive> <value>"}),"."]}),"\n",(0,n.jsx)(i.h3,{id:"fetch-directives",children:"Fetch Directives"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Fetch directives"})," determines the locations that the resources are allowed to fetch."]}),"\n",(0,n.jsx)(i.h4,{id:"default-src",children:(0,n.jsx)(i.code,{children:"default-src"})}),"\n",(0,n.jsx)(i.p,{children:"Serves as a fallback for other fetch directives."}),"\n",(0,n.jsx)(i.h4,{id:"script-src",children:(0,n.jsx)(i.code,{children:"script-src"})}),"\n",(0,n.jsx)(i.p,{children:"Specifies the valid sources for JavaScript and WebAssembly resources."}),"\n",(0,n.jsx)(i.h4,{id:"font-src",children:(0,n.jsx)(i.code,{children:"font-src"})}),"\n",(0,n.jsxs)(i.p,{children:["Specifies the valid sources of fonts loaded via ",(0,n.jsx)(i.code,{children:"@font-face"}),"."]}),"\n",(0,n.jsx)(i.h4,{id:"img-src",children:(0,n.jsx)(i.code,{children:"img-src"})}),"\n",(0,n.jsx)(i.p,{children:"Specifies the valid sources of images and favicons."}),"\n",(0,n.jsx)(i.h4,{id:"style-src",children:(0,n.jsx)(i.code,{children:"style-src"})}),"\n",(0,n.jsx)(i.p,{children:"Specifies the valid sources for stylesheets."}),"\n",(0,n.jsx)(i.h3,{id:"navigation-directives",children:"Navigation Directives"}),"\n",(0,n.jsx)(i.p,{children:"These directives control which locations a user can navigate or submit a form."}),"\n",(0,n.jsx)(i.h4,{id:"form-action",children:(0,n.jsx)(i.code,{children:"form-action"})}),"\n",(0,n.jsx)(i.p,{children:"Restricts the URLs which can be used as the target of a form submission."}),"\n",(0,n.jsx)(i.h4,{id:"navigate-to",children:(0,n.jsx)(i.code,{children:"navigate-to"})}),"\n",(0,n.jsxs)(i.p,{children:["Restricts the URLs that the user can navigate to. e.g., ",(0,n.jsx)(i.code,{children:"<a>"}),", ",(0,n.jsx)(i.code,{children:"window.location"}),", ",(0,n.jsx)(i.code,{children:"window.open"}),", etc."]}),"\n",(0,n.jsx)(i.h3,{id:"reporting-directives",children:"Reporting Directives"}),"\n",(0,n.jsxs)(i.p,{children:["These directives control the reporting process of CSP violations. It is configured by ",(0,n.jsx)(i.code,{children:"Content-Security-Policy-Report-Only"})," header."]}),"\n",(0,n.jsx)(i.h4,{id:"report-uri",children:(0,n.jsx)(i.code,{children:"report-uri"})}),"\n",(0,n.jsx)(i.h4,{id:"report-to",children:(0,n.jsx)(i.code,{children:"report-to"})}),"\n",(0,n.jsx)(i.h3,{id:"other-directives",children:"Other Directives"}),"\n",(0,n.jsx)(i.h4,{id:"trusted-types",children:(0,n.jsx)(i.code,{children:"trusted-types"})}),"\n",(0,n.jsxs)(i.p,{children:["Used to specify an allowlist of trusted policies. It allows applications to lock down ",(0,n.jsx)(i.strong,{children:"DOM XSS"})," injection attacks to only accept ",(0,n.jsx)(i.strong,{children:"typed"})," values in place of strings."]}),"\n",(0,n.jsx)(i.h4,{id:"upgrade-insecure-requests",children:(0,n.jsx)(i.code,{children:"upgrade-insecure-requests"})}),"\n",(0,n.jsx)(i.p,{children:"Instructs the site to treat all of insecure URLs as they have been replaced with secure URLs."}),"\n",(0,n.jsx)(i.h3,{id:"values",children:"Values"}),"\n",(0,n.jsx)(i.h4,{id:"-keyword-values",children:"\ud83d\udd11 Keyword Values"}),"\n",(0,n.jsx)(i.h5,{id:"none",children:(0,n.jsx)(i.code,{children:"none"})}),"\n",(0,n.jsx)(i.p,{children:"Won't allow loading of any resources."}),"\n",(0,n.jsx)(i.h5,{id:"self",children:(0,n.jsx)(i.code,{children:"self"})}),"\n",(0,n.jsxs)(i.p,{children:["Only allow resources from the current ",(0,n.jsx)(i.strong,{children:"origin"}),"."]}),"\n",(0,n.jsx)(i.h5,{id:"strict-dynamic",children:(0,n.jsx)(i.code,{children:"strict-dynamic"})}),"\n",(0,n.jsx)(i.p,{children:"Allow scripts which loaded dynamically by trusted scripts to load."}),"\n",(0,n.jsx)(i.h4,{id:"-hosts-values",children:"\ud83d\udd17 Hosts Values"}),"\n",(0,n.jsxs)(i.p,{children:["It can be either ",(0,n.jsx)(i.strong,{children:"Host"})," or ",(0,n.jsx)(i.strong,{children:"Scheme"}),"."]}),"\n",(0,n.jsx)(i.h5,{id:"host",children:"Host"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Only allow loading of resources from a specific host, with optional scheme, port, and path. e.g., ",(0,n.jsx)(i.code,{children:"xiaohai.wiki"}),", ",(0,n.jsx)(i.code,{children:"*.xiaohai.wiki"}),", ",(0,n.jsx)(i.code,{children:"https://*.xiaohai.wiki:233/path/src/hello.js"})]}),"\n",(0,n.jsxs)(i.li,{children:["Path ends with ",(0,n.jsx)(i.code,{children:"/"})," match any path they are a prefix of. e.g. ",(0,n.jsx)(i.code,{children:"xiaohai.wiki/api/"})," will match URLs like ",(0,n.jsx)(i.code,{children:"xiaohai.wiki/api/users"}),"."]}),"\n",(0,n.jsxs)(i.li,{children:["Other path parts in the CSP are matched exactly e.g. ",(0,n.jsx)(i.code,{children:"xiaohai.wiki/hello.js"})," will match ",(0,n.jsx)(i.code,{children:"http://xiaohai.wiki/hello.js"})," and the ",(0,n.jsx)(i.strong,{children:"https"})," version of it, but not ",(0,n.jsx)(i.code,{children:"https://xiaohai.wiki/yes.js"}),"."]}),"\n"]}),"\n",(0,n.jsx)(i.h5,{id:"scheme",children:"Scheme"}),"\n",(0,n.jsxs)(i.p,{children:['Only allow loading of resources over a specific scheme, should always end with "',(0,n.jsx)(i.code,{children:":"}),'".']}),"\n",(0,n.jsxs)(i.p,{children:["For example, ",(0,n.jsx)(i.code,{children:"https:"}),", ",(0,n.jsx)(i.code,{children:"http:"}),", ",(0,n.jsx)(i.code,{children:"data:"})," etc."]}),"\n",(0,n.jsx)(i.h4,{id:"\ufe0f-other-values",children:"\ud83d\udc7d\ufe0f Other Values"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"nonce-*"})}),"\n",(0,n.jsx)(i.p,{children:"A nonce is an arbitrary number that can be used just once in a cryptographic communication."}),"\n",(0,n.jsxs)(i.p,{children:["The server must generate a unique nonce value each it transmits a policy. This is used in conjunction with the ",(0,n.jsx)(i.a,{href:"/docs/Web/HTML/script-tag",children:"script"})," tag's ",(0,n.jsx)(i.strong,{children:"nonce attribute"}),"."]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"sha*-*"})}),"\n",(0,n.jsxs)(i.p,{children:["e.g. ",(0,n.jsx)(i.code,{children:"sha256-jzgBGA4UWFFmpOBq0JpdsySukE1FrEN5bUpoK8Z29fY="})]}),"\n",(0,n.jsx)(i.h2,{id:"injection-defense",children:"Injection Defense"}),"\n",(0,n.jsx)(i.h3,{id:"nonce-based-csp",children:"Nonce-Based CSP"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.code,{children:"Content-Security-Policy: script-src 'nonce-...' 'strict-dynamic'"})}),"\n",(0,n.jsxs)(i.p,{children:["Modify ",(0,n.jsx)(i.code,{children:"<script>"})," tags to include a ",(0,n.jsx)(i.em,{children:"nonce"})," which changes on each response."]}),"\n",(0,n.jsx)(i.h3,{id:"trusted-types-1",children:"Trusted Types"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.code,{children:"Content-Security-Policy: trusted-types myPolicy"})}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Enforce type restrictions for unsafe DOM APIs."}),"\n",(0,n.jsx)(i.li,{children:"Create safe types in policy functions."}),"\n"]}),"\n",(0,n.jsxs)(i.admonition,{type:"info",children:[(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"origins & sites"})}),(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Two URLs are ",(0,n.jsx)(i.code,{children:"same-origin"})," if they share the same ",(0,n.jsx)(i.strong,{children:"scheme"}),", ",(0,n.jsx)(i.strong,{children:"host"})," and ",(0,n.jsx)(i.strong,{children:"port"}),".","\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://xiaohai.wiki/docs",children:"https://xiaohai.wiki/docs"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://xiaohai.wiki/docs/Web/JavaScript/memory-management",children:"https://xiaohai.wiki/docs/Web/JavaScript/memory-management"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["Two URLs are ",(0,n.jsx)(i.code,{children:"same-site"})," if they share the same ",(0,n.jsx)(i.strong,{children:"schema"})," & ",(0,n.jsx)(i.strong,{children:"registrable domain"}),".","\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://fhfhockey.com/",children:"https://fhfhockey.com/"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://cms.fhfhockey.com/",children:"https://cms.fhfhockey.com/"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["Otherwise, the URLs are ",(0,n.jsx)(i.code,{children:"cross-site"}),".","\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://xiaohai.wiki/",children:"https://xiaohai.wiki/"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://fhfhockey.com/",children:"https://fhfhockey.com/"})}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,n.jsx)(i.h2,{id:"references",children:"References"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://www.youtube.com/watch?v=DDtM9caQ97I",children:"Securing Web Apps with Modern Platform Features (Google I/O \u201919)"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP",children:"CSP | MDN"})}),"\n"]})]})}const a=function(e={}){const{wrapper:i}=Object.assign({},(0,c.ah)(),e.components);return i?(0,n.jsx)(i,Object.assign({},e,{children:(0,n.jsx)(h,e)})):h(e)}},11151:(e,i,s)=>{s.d(i,{Zo:()=>o,ah:()=>t});var n=s(67294);const c=n.createContext({});function t(e){const i=n.useContext(c);return n.useMemo((()=>"function"==typeof e?e(i):{...i,...e}),[i,e])}const r={};function o({components:e,children:i,disableParentContext:s}){let o;return o=s?"function"==typeof e?e({}):e||r:t(e),n.createElement(c.Provider,{value:o},i)}}}]);