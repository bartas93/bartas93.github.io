(self.webpackChunklearning_notes=self.webpackChunklearning_notes||[]).push([[890],{22453:(e,n,i)=>{"use strict";i.r(n),i.d(n,{assets:()=>y,contentTitle:()=>g,default:()=>w,frontMatter:()=>f,metadata:()=>b,toc:()=>v});var s=i(85893),o=i(11151),t=i(61830),l=i(66180);const c='function baz() {\n  // call-stack is: `baz`\n  // so, our call-site is in the global scope\n  console.log("baz");\n  bar(); // <-- call-site for `bar`\n}\n\nfunction bar() {\n  // call-stack is: `baz` -> `bar`\n  // so, our call-site is in `baz`\n\n  console.log("bar");\n  foo(); // <-- call-site for `foo`\n}\n\nfunction foo() {\n  // call-stack is: `baz` -> `bar` -> `foo`\n  // so, our call-site is in `bar`\n\n  debugger; // remove this line to view the console output\n\n  console.log("foo");\n}\n\nbaz(); // <-- call-site for `baz`\n\n// Retrieved from https://github.com/getify/You-Dont-Know-JS/blob/1st-ed/this%20%26%20object%20prototypes/ch2.md',a='function sayNameFunc() {\n  console.log(`Hello, my name is ${this.name}`);\n}\n\nconst person = {\n  name: "xiaohai",\n  sayName: sayNameFunc,\n};\n\nperson.sayName(); // Hello, my name is xiaohai',r='function sayNameFunc() {\n  console.log(`Hello, my name is ${this.name}`);\n}\n\nconst person = {\n  name: "xiaohai",\n  sayName: sayNameFunc,\n};\n\nconst home = {\n  name: "QuanZhou",\n  owner: person,\n};\n\nperson.sayName(); // Hello, my name is xiaohai\nhome.owner.sayName(); // Hello, my name is xiaohai',d='function sayNameFunc() {\n  console.log(`Hello, my name is ${this.Name}.`);\n}\n\nconst person = {\n  Name: "xiaohai",\n};\n\nconst sayNameBinded = function () {\n  sayNameFunc.call(person);\n};\n\nsayNameBinded();\nsayNameBinded.call({ Name: "name passed by the line 14 call" });\n\nsayNameFunc.call({ Name: "fake name" });',h='function Person(name) {\n  this.Name = name;\n}\n\nconst person = new Person("xiaohai");\nconsole.log(person.Name);',u='function Person(name) {\n  this.Name = name;\n}\n\nconst p1 = {};\nconst PersonAnother = Person.bind(p1);\nPersonAnother("dan-dan");\n\nconsole.log(p1.Name);\n\nconst p2 = new PersonAnother("xiaohai");\nconsole.log(p1.Name);\nconsole.log(p2.Name);',m='const person1 = {\n  Name: "xiaohai",\n  sayName: () => {\n    console.log(`Hello, my name is ${this.Name}`);\n  },\n};\n\nconst person2 = {};\nperson2.Name = "xiaohai";\nperson2.sayName = () => {\n  console.log(`Hello, my name is ${this.Name}`);\n};\n\n// pre-es6\nvar self = this; // captures this\nconst person3 = {};\nperson3.Name = "xiaohai";\nperson3.sayName = function () {\n  console.log(`Hello, my name is ${self.Name}`);\n};\n\nfunction sayName() {\n  console.log(`Hello, my name is ${this.Name}`);\n}\n\nvar Name = "[[Global Name]]";\nperson1.sayName(); // Hello, my name is [[Global Name]]\nperson2.sayName(); // Hello, my name is [[Global Name]]\nperson3.sayName(); // Hello, my name is [[Global Name]]\nsayName(); // Hello, my name is [[Global Name]]\n',x='function Person(name) {\n  this.Name = name;\n  this.sayName = () => {\n    console.log(`Hello, my name is ${this.Name}`);\n  };\n  // pre-es6\n  var self = this;\n  this.sayNameFunc = function () {\n    console.log(`Hello, my name is ${self.Name}`);\n  };\n}\n\nconst person = new Person("xiaohai");\n// polyfill: these two ways of defining functions have the same effect\nperson.sayName();\nperson.sayNameFunc();',p='function Person(name) {\n  this.Name = name;\n  this.sayName = () => {\n    console.log(`Hello, my name is ${this.Name}`);\n  };\n}\n\nconst person1 = new Person("xiaohai");\nconst person2 = new Person("dan-dan");\n\nperson2.sayName();\n// [[implict binding]] cannot change `this`\n// p1\'s sayName still points at person1\nperson2.sayName = person1.sayName;\nperson2.sayName();\n\n// [[explict binding]] cannot change `this`\nconsole.log(person1);\nperson2.sayName.call(person1);',j='class Person {\n  constructor(name) {\n    this.Name = name;\n  }\n  sayNameMethod() {\n    console.log(`Hello, my name is ${this.Name}`);\n  }\n  sayNamePropFunc = function () {\n    console.log(`Hello, my name is ${this.Name}`);\n  };\n  sayNamePropArrow = () => {\n    console.log(`Hello, my name is ${this.Name}`);\n  };\n}\n\nconst person1 = new Person("xiaohai");\n\nperson1.sayNameMethod();\nperson1.sayNamePropFunc();\nperson1.sayNamePropArrow();\n\nperson1.sayNameMethod.call({ Name: "[[called by call(...)]]" }); // work\nperson1.sayNamePropFunc.call({ Name: "[[called by call(...)]]" }); // work\nperson1.sayNamePropArrow.call({ Name: "[[called by call(...)]]" }); // does not work',f={sidebar_label:"\u261d this keyword",title:"\u261d this keyword"},g=void 0,b={id:"Web/JavaScript/this",title:"\u261d this keyword",description:"Useful resources:",source:"@site/docs/Web/JavaScript/01-this.mdx",sourceDirName:"Web/JavaScript",slug:"/Web/JavaScript/this",permalink:"/docs/Web/JavaScript/this",draft:!1,unlisted:!1,editUrl:"https://github.com/xiaohai-huang/learning-notes/tree/master/docs/Web/JavaScript/01-this.mdx",tags:[],version:"current",lastUpdatedBy:"xiaohai-huang",lastUpdatedAt:1670207340,formattedLastUpdatedAt:"05 Dec 2022",sidebarPosition:1,frontMatter:{sidebar_label:"\u261d this keyword",title:"\u261d this keyword"},sidebar:"notesSidebar",previous:{title:"JavaScript",permalink:"/docs/Web/JavaScript/"},next:{title:"\ud83d\udef8 Shadowing",permalink:"/docs/Web/JavaScript/shadowing"}},y={},v=[{value:"What is <code>this</code> ?",id:"what-is-this-",level:2},{value:"How to determine call-site ?",id:"call-site",level:2},{value:"4 Rules",id:"rules",level:2},{value:"Default Binding",id:"default-binding",level:3},{value:"Strict Mode Behavior",id:"strict-mode-behavior",level:4},{value:"Implicit Binding",id:"implicit-binding",level:3},{value:"Implicitly Lost",id:"implicit-lost",level:4},{value:"Explicit Binding",id:"explicit-binding",level:3},{value:"Hard Binding",id:"hard-binding",level:4},{value:"<code>new</code> Binding",id:"new-binding",level:3},{value:"Priority of Rules",id:"priority-of-rules",level:2},{value:"Explicit vs Implicit",id:"explicit-vs-implicit",level:3},{value:"<code>new</code> vs Explicit",id:"new-vs-explicit",level:3},{value:"Binding Exceptions",id:"binding-exceptions",level:2},{value:"Lexical <code>this</code>",id:"lexical-this",level:2},{value:"Questions",id:"questions",level:2}];function N(e){const n=Object.assign({p:"p",ul:"ul",li:"li",a:"a",h2:"h2",code:"code",blockquote:"blockquote",strong:"strong",img:"img",em:"em",ol:"ol",h3:"h3",pre:"pre",h4:"h4",admonition:"admonition"},(0,o.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Useful resources:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/a/3127440",children:"Stack overflow"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/getify/You-Dont-Know-JS/blob/1st-ed/this%20&%20object%20prototypes/README.md#you-dont-know-js-this--object-prototypes",children:"You Don't Know JS: this & Object Prototypes - 1st Edition (ch1 ~ ch2)"})}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"what-is-this-",children:["What is ",(0,s.jsx)(n.code,{children:"this"})," ?"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"this"})," is a binding that is made when a function is invoked, what it references is determined by entirely by the ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"})})," where the function is called.\nWhen a function is invoked, an ",(0,s.jsx)(n.strong,{children:"execution context"})," is created which contains the following information:"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/todos",children:"Execution context"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Where the function was called from (the ",(0,s.jsx)(n.a,{href:"/todos",children:"call stack"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"How the function was invoked"}),"\n",(0,s.jsx)(n.li,{children:"What parameters were passed"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"this"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"execution context",src:i(48230).Z+"",width:"901",height:"605"})}),"\n",(0,s.jsxs)(n.p,{children:["One of the most important properties of ",(0,s.jsx)(n.a,{href:"/todos",children:"execution context"})," is the ",(0,s.jsx)(n.code,{children:"this"})," reference that will be used for the duration of that function call."]}),"\n",(0,s.jsx)(n.h2,{id:"call-site",children:"How to determine call-site ?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"}),": The location in code where a function is called (not where it's declared)."]}),"\n",(0,s.jsxs)(n.p,{children:["Because ",(0,s.jsx)(n.a,{href:"/todos",children:"call stack"})," is a stack of functions that have been called to get us to the current moment of execution. The call-site of a function is in the invocation ",(0,s.jsx)(n.em,{children:"before"})," the currently executing function. In other words, it is the second item from the top of ",(0,s.jsx)(n.a,{href:"/todos",children:"call stack"}),". see the the image below"]}),"\n",(0,s.jsx)(t.Z,{title:"call-site explanation",run:!1,children:c}),"\n",(0,s.jsx)(n.p,{children:"Insert a debugger at the code above"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"call-site",src:i(69776).Z+"",width:"897",height:"633"})}),"\n",(0,s.jsxs)(n.p,{children:["In this example, the ",(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"})," of function ",(0,s.jsx)(n.code,{children:"foo"})," (currently executing function), is in ",(0,s.jsx)(n.code,{children:"bar"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"rules",children:"4 Rules"}),"\n",(0,s.jsxs)(n.p,{children:["How to determine where ",(0,s.jsx)(n.code,{children:"this"})," will point during the ",(0,s.jsx)(n.strong,{children:"execution of a function"})," ?"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Find the ",(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"})]}),"\n",(0,s.jsx)(n.li,{children:"Determine which of 4 rules applies."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These 4 rules are applied in this order:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Called with ",(0,s.jsx)(n.code,{children:"new"}),"? Use the ",(0,s.jsx)(n.strong,{children:"newly constructed object"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Called with ",(0,s.jsx)(n.code,{children:"call"}),", ",(0,s.jsx)(n.code,{children:"apply"})," (or ",(0,s.jsx)(n.code,{children:"bind"}),")? Use the specified object."]}),"\n",(0,s.jsxs)(n.li,{children:["Called with a context object in front of the call? Use that object. e.g. ",(0,s.jsx)(n.code,{children:"person.sayName()"})]}),"\n",(0,s.jsxs)(n.li,{children:["Default: ",(0,s.jsx)(n.code,{children:"strict mode"})," ? ",(0,s.jsx)(n.code,{children:"undefined"})," : ",(0,s.jsx)(n.code,{children:"globalThis"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"default-binding",children:"Default Binding"}),"\n",(0,s.jsxs)(n.p,{children:["If a function is called with a ",(0,s.jsx)(n.em,{children:"plain, un-decorated function reference"}),", then ",(0,s.jsx)(n.em,{children:"default binding"})," applies.\nThe ",(0,s.jsx)(n.em,{children:"default binding"})," make ",(0,s.jsx)(n.code,{children:"this"})," points at the global object."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="standalone function invocation" {2,7}',children:"function foo() {\n  console.log(this.a);\n}\n\nvar a = 2; // is declared in the global scope\n\nfoo(); // 2 -- call-site at this line\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Follow the ",(0,s.jsx)(n.a,{href:"#rules",children:"instruction"}),". The first step is to find the ",(0,s.jsx)(n.strong,{children:"call-site"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"call-site of default binding example",src:i(48211).Z+"",width:"453",height:"71"})}),"\n",(0,s.jsxs)(n.p,{children:["In this example, ",(0,s.jsx)(n.code,{children:"foo()"})," is called with a ",(0,s.jsx)(n.em,{children:"plain, un-decorated function reference"}),", so ",(0,s.jsx)(n.em,{children:"default binding"})," applies."]}),"\n",(0,s.jsx)(n.h4,{id:"strict-mode-behavior",children:"Strict Mode Behavior"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.a,{href:"/todos",children:"strict mode"}),", the global object is not eligible for the ",(0,s.jsx)(n.em,{children:"default binding"}),". That means ",(0,s.jsx)(n.code,{children:"this"})," will be set to ",(0,s.jsx)(n.code,{children:"undefined"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:"title='\"use strict\" in function definition (contents)' {2,8}",children:"function foo() {\n  \"use strict\";\n  console.log(this.a);\n}\n\nvar a = 2; // is declared in the global scope\n\nfoo(); // Uncaught TypeError: Cannot read properties of undefined (reading 'a')\n"})}),"\n",(0,s.jsxs)(n.p,{children:["One ",(0,s.jsx)(n.strong,{children:"important"})," detail to remember is that: the global object is ",(0,s.jsx)(n.strong,{children:"only"})," eligible for the ",(0,s.jsx)(n.em,{children:"default binding"})," if the contents of ",(0,s.jsx)(n.code,{children:"foo()"})," are not running in ",(0,s.jsx)(n.code,{children:"strict mode"}),". The ",(0,s.jsx)(n.code,{children:"strict mode"})," in call-site of ",(0,s.jsx)(n.code,{children:"foo()"})," is irrelevant."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:"title='\"use strict\" in call-site' {2,8-9}",children:'function foo() {\n  console.log(this.a);\n}\n\nvar a = 2; // is declared in the global scope\n\n(() => {\n  "use strict";\n  foo(); // 2\n})();\n'})}),"\n",(0,s.jsx)(n.h3,{id:"implicit-binding",children:"Implicit Binding"}),"\n",(0,s.jsxs)(n.p,{children:["When a function preceded by an ",(0,s.jsx)(n.code,{children:"object"})," is called, the ",(0,s.jsx)(n.em,{children:"implicit binding"})," rule says: that ",(0,s.jsx)(n.code,{children:"object"})," should be used as the function call's ",(0,s.jsx)(n.code,{children:"this"})," binding."]}),"\n",(0,s.jsx)(t.Z,{children:a}),"\n",(0,s.jsxs)(n.p,{children:["Because ",(0,s.jsx)(n.code,{children:"person"})," is the ",(0,s.jsx)(n.code,{children:"this"})," for the ",(0,s.jsx)(n.code,{children:"sayName()"})," call, therefore, ",(0,s.jsx)(n.code,{children:"this.name"})," is synonymous with ",(0,s.jsx)(n.code,{children:"person.name"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Only the last object reference matters to the ",(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"}),"."]}),"\n",(0,s.jsx)(t.Z,{children:r}),"\n",(0,s.jsx)(n.h4,{id:"implicit-lost",children:"Implicitly Lost"}),"\n",(0,s.jsxs)(n.p,{children:["One common issue of implicit binding is that it might lose its ",(0,s.jsx)(n.code,{children:"this"})," binding. That usually means ",(0,s.jsx)(n.code,{children:"this"})," falls back to the ",(0,s.jsx)(n.a,{href:"#default-binding",children:(0,s.jsx)(n.em,{children:"default binding"})})," which is either the global object or ",(0,s.jsx)(n.code,{children:"undefined"}),", depending on ",(0,s.jsx)(n.code,{children:"strict mode"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="Implicitly lost - 01"',children:"function sayAgeFunc() {\n  console.log(`Hello, I'm ${this.age} years old.`);\n}\n\nconst person = {\n  age: 22,\n  sayAge: sayAgeFunc,\n};\n\nvar age = \"global age!!!\";\n\nconst sayAgeStandAlone = person.sayAge;\n\nsayAgeStandAlone(); // Hello, I'm global age!!! years old.\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In this example, the ",(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"})," of ",(0,s.jsx)(n.code,{children:"sayAgeStandAlone()"})," is a ",(0,s.jsx)(n.em,{children:"plain, un-decorated call"}),", therefore the ",(0,s.jsx)(n.a,{href:"#default-binding",children:(0,s.jsx)(n.em,{children:"default binding"})})," applies."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="Implicitly lost - 02"',children:'function sayNameFunc() {\n  console.log(`Hello, my name is ${this.Name}.`);\n}\nfunction sayAgeFunc() {\n  console.log(`Hello, I\'m ${this.Age} years old!`);\n}\n\nfunction introduce(first, second) {\n  first();\n  second();\n}\n\nconst person = {\n  Name: "xiaohai",\n  Age: 22,\n  sayName: sayNameFunc,\n  sayAge: sayAgeFunc,\n};\n\nvar Name = "[[Global Name]]";\nvar Age = "[[Global Age]]";\n\nperson.sayName(); // Hello, my name is xiaohai.\nperson.sayAge(); // Hello, I\'m 22 years old!\n\nintroduce(person.sayName, person.sayAge);\n// Hello, my name is [[Global Name]].\n// Hello, I\'m [[Global Age]] years old!\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsxs)(n.p,{children:["As you can see that, ",(0,s.jsx)(n.code,{children:"this"})," is changed unexpectedly, we don't have control over how the function will be executed. That means that we have no way of controlling the ",(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"})," to make function call's ",(0,s.jsx)(n.code,{children:"this"})," to stick with the intended binding."]})}),"\n",(0,s.jsx)(n.h3,{id:"explicit-binding",children:"Explicit Binding"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"func.call()"}),", ",(0,s.jsx)(n.code,{children:"func.apply()"}),", ",(0,s.jsx)(n.code,{children:"func.bind()"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"func.call()"}),", ",(0,s.jsx)(n.code,{children:"func.apply()"})," takes an object as the first parameter which will be used as ",(0,s.jsx)(n.code,{children:"this"}),", and invoke the function. Because you are directly defining what you want the ",(0,s.jsx)(n.code,{children:"this"})," to be, it is known as ",(0,s.jsx)(n.em,{children:"explicit binding"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="Explicit binding - 01"',children:'function sayNameFunc() {\n  console.log(`Hello, my name is ${this.Name}.`);\n}\n\nconst person = {\n  Name: "xiaohai",\n  sayName: sayNameFunc,\n};\n\nperson.sayName(); // Hello, my name is xiaohai.\nsayNameFunc.call(person); // Hello, my name is xiaohai.\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Invoking ",(0,s.jsx)(n.code,{children:"sayNameFunc"})," with ",(0,s.jsx)(n.em,{children:"explicit binding"})," by ",(0,s.jsx)(n.code,{children:"sayNameFunc.call(...)"})," enable us to bind its ",(0,s.jsx)(n.code,{children:"this"})," to be ",(0,s.jsx)(n.code,{children:"person"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["If a primitive value (",(0,s.jsx)(n.code,{children:"string"}),", ",(0,s.jsx)(n.code,{children:"boolean"}),", or ",(0,s.jsx)(n.code,{children:"number"}),") is passed as the first parameter ",(0,s.jsx)(n.code,{children:"this"})," binding, the primitive value is wrapped in its ",(0,s.jsx)(n.strong,{children:"object-form"})," (",(0,s.jsx)(n.code,{children:"new String(...)"}),", ",(0,s.jsx)(n.code,{children:"new Boolean(...)"}),", or ",(0,s.jsx)(n.code,{children:"new Number(...)"}),', respectively). That behavior is known as "boxing".']})}),"\n",(0,s.jsx)(n.h4,{id:"hard-binding",children:"Hard Binding"}),"\n",(0,s.jsxs)(n.p,{children:["However, ",(0,s.jsx)(n.code,{children:"func.call()"}),", ",(0,s.jsx)(n.code,{children:"func.apply()"})," still doesn't solve the problem (",(0,s.jsx)(n.a,{href:"#implicit-lost",children:"implicit lost"}),') "a function ',(0,s.jsx)(n.strong,{children:"losing"})," its intended ",(0,s.jsx)(n.code,{children:"this"}),' binding".']}),"\n",(0,s.jsxs)(n.p,{children:["But a variation pattern around ",(0,s.jsx)(n.em,{children:"explicit binding"})," can solve the problem."]}),"\n",(0,s.jsx)(t.Z,{children:d}),"\n",(0,s.jsxs)(n.p,{children:["We can use ES5: ",(0,s.jsx)(n.code,{children:"Function.prototype.bind"})," to achieve the same result shown above. Below is a simple version of ",(0,s.jsx)(n.code,{children:"bind"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"function bind(func, thisObject) {\n  return function (...args) {\n    // Don't forget to return the value computed by the func\n    return func.call(thisObject, ...args);\n  };\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"func.bind(...)"})," returns a new function that will call the original function with ",(0,s.jsx)(n.code,{children:"this"})," set as you specified."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["In ES6, the function created by ",(0,s.jsx)(n.code,{children:"bind(...)"})," has a ",(0,s.jsx)(n.code,{children:"name"})," property that derived from the original target function. ",(0,s.jsx)(n.code,{children:"newFunc = func.bind(...)"}),", ",(0,s.jsx)(n.code,{children:"newFunc"}),"'s ",(0,s.jsx)(n.code,{children:"name"})," property should be ",(0,s.jsx)(n.code,{children:"bound func"})]})}),"\n",(0,s.jsxs)(n.h3,{id:"new-binding",children:[(0,s.jsx)(n.code,{children:"new"})," Binding"]}),"\n",(0,s.jsxs)(n.p,{children:["When a function is invoked with ",(0,s.jsx)(n.code,{children:"new"})," in front of it, the following things are done automatically."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"a brand new object is created."}),"\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.strong,{children:"newly constructed object"}),"'s prototype is set to ",(0,s.jsx)(n.code,{children:"Func.prototype"}),". see ",(0,s.jsx)(n.a,{href:"/docs/Web/JavaScript/prototype#constructor",children:"constructor"})]}),"\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.strong,{children:"newly constructed object"})," is set as the ",(0,s.jsx)(n.code,{children:"this"})," binding for the function call."]}),"\n",(0,s.jsxs)(n.li,{children:["execute the constructor to populate the ",(0,s.jsx)(n.strong,{children:"newly constructed object"})," if necessary."]}),"\n",(0,s.jsxs)(n.li,{children:["if there is no ",(0,s.jsx)(n.code,{children:"return"}),", the function will return the ",(0,s.jsx)(n.strong,{children:"newly constructed object"}),". Otherwise, perform the normal return."]}),"\n"]}),"\n",(0,s.jsx)(t.Z,{title:"new binding example 1",children:h}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["mimic ",(0,s.jsx)(n.code,{children:"new"})," operator"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"function mynew(Func, ...args) {\n  // 1.create a brand new object\n  const obj = {};\n  // 2.set the new object's prototype to be the Func.prototype.\n  obj.__proto__ = Func.prototype;\n  // 3.set `this` using .apply() and run the constructor code\n  let result = Func.apply(obj, args);\n  // 4.check if the constructor returns\n  return result instanceof Object ? result : obj;\n}\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"priority-of-rules",children:"Priority of Rules"}),"\n",(0,s.jsxs)(n.p,{children:["What happened if the ",(0,s.jsx)(n.a,{href:"#call-site",children:"call-site"})," has multiple eligible rules? What order to apply these rules?"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#new-binding",children:"new binding"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#explicit-binding",children:"explicit binding"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#implicit-binding",children:"implicit binding"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#default-binding",children:"default binding"})," has the lowest priority among the 4."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"explicit-vs-implicit",children:"Explicit vs Implicit"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="explicit > implicit"',children:'function sayNameFunc() {\n  console.log(`Hello, my name is ${this.Name}.`);\n}\n\nconst person = {\n  Name: "xiaohai",\n  sayName: sayNameFunc,\n};\n\nconst person2 = {\n  Name: "dan-dan",\n};\n\nperson.sayName.call(person2);\n// Hello, my name is Hello, my name is dan-dan.\n'})}),"\n",(0,s.jsxs)(n.h3,{id:"new-vs-explicit",children:[(0,s.jsx)(n.code,{children:"new"})," vs Explicit"]}),"\n",(0,s.jsx)(t.Z,{title:"new > explicit",children:u}),"\n",(0,s.jsx)(n.h2,{id:"binding-exceptions",children:"Binding Exceptions"}),"\n",(0,s.jsxs)(n.p,{children:["If you pass ",(0,s.jsx)(n.code,{children:"null"})," or ",(0,s.jsx)(n.code,{children:"undefined"})," as the first argument to ",(0,s.jsx)(n.code,{children:"call"}),", ",(0,s.jsx)(n.code,{children:"apply"}),", or ",(0,s.jsx)(n.code,{children:"bind"}),", the value you passed will be ignored, and instead the ",(0,s.jsx)(n.a,{href:"#default-binding",children:"default binding"})," rule applies."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="pass null to call"',children:'function sayNameFunc() {\n  console.log(`Hello, my name is ${this.Name}.`);\n}\n\nconst person = {\n  Name: "xiaohai",\n  sayName: sayNameFunc,\n};\n\nvar Name = "[[Global Name]]";\n\nperson.sayName.call(null);\n// Hello, my name is [[Global Name]].\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"lexical-this",children:["Lexical ",(0,s.jsx)(n.code,{children:"this"})]}),"\n",(0,s.jsxs)(n.p,{children:["ES6 introduces ",(0,s.jsx)(n.strong,{children:"arrow-function"})," which doesn't follow the rules specified above."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"arrow-functions adopt the this binding from the enclosing (function or global) scope."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/a/36717461",children:"arrow-function in object literal"})}),"\n",(0,s.jsx)(l.Z,{className:"language-js",title:"arrow-function in object literal",children:m}),"\n",(0,s.jsx)(l.Z,{className:"language-js",title:"polyfill for arrow-function",children:x}),"\n",(0,s.jsx)(t.Z,{title:"arrow-function's this cannot be changed after created",children:p}),"\n",(0,s.jsxs)(n.p,{children:["Instance methods in ",(0,s.jsx)(n.code,{children:"class"})," are just normal function. see below"]}),"\n",(0,s.jsx)(t.Z,{title:"instance method behavior",children:j}),"\n",(0,s.jsx)(n.h2,{id:"questions",children:"Questions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="Question 1"',children:'window.name = "hello";\n\nfunction Foo() {\n  console.log(JSON.stringify(this)); // {}\n  this.name = "bar";\n  this.getName = function () {\n    return this.name;\n  };\n}\nconst { log } = console;\nlet foo = new Foo(); // This line logs the newly constructed object {}\nlet getName = foo.getName;\n\nlog(foo.getName()); // new binding\nlog(getName()); // implicit binding lost - use default binding\nlog(Foo.bind(foo).getName); // Foo.getName is undefined\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="Question 2" {4}',children:"var obj = {\n  a: 1,\n  foo: function (b) {\n    b = b || this.a;\n    return function (c) {\n      console.log(this.a);\n      console.log(b);\n      console.log(c);\n    };\n  },\n};\n\nvar a = 2;\nvar obj2 = { a: 3 };\n\nobj.foo(a).call(obj2, 1);\nobj.foo.call(obj2)(1);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"obj.foo.call(obj2)"})," create a function close over ",(0,s.jsx)(n.code,{children:"foo"})," so it can access to the value of ",(0,s.jsx)(n.code,{children:"b"})," defined in ",(0,s.jsx)(n.code,{children:"foo"}),". Secondly, it is a ",(0,s.jsx)(n.strong,{children:"standalone function invocation"}),", ",(0,s.jsx)(n.a,{href:"#default-binding",children:"default binding"})," rule is applied to determine whether ",(0,s.jsx)(n.code,{children:"this"})," should point to ",(0,s.jsx)(n.code,{children:" globalThis"})," or ",(0,s.jsx)(n.code,{children:"undefined "}),"."]})]})}const w=function(e={}){const{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(N,e)})):N(e)}},61830:(e,n,i)=>{"use strict";i.d(n,{Z:()=>A});var s=i(67294),o=i(91262),t=i(10412),l=i(40460),c=i.n(l),a=i(70631),r=i.n(a),d=i(87410),h=i(71418),u=i(86010);const m=/\r\n|\r|\n/,x=e=>{0===e.length?e.push({types:["plain"],content:"\n",empty:!0}):1===e.length&&""===e[0].content&&(e[0].content="\n",e[0].empty=!0)},p=(e,n)=>{const i=e.length;return i>0&&e[i-1]===n?e:e.concat(n)},j=e=>{const n=[[]],i=[e],s=[0],o=[e.length];let t=0,l=0,c=[];const a=[c];for(;l>-1;){for(;(t=s[l]++)<o[l];){let e,r=n[l];const d=i[l][t];if("string"==typeof d?(r=l>0?r:["plain"],e=d):(r=p(r,d.type),d.alias&&(r=p(r,d.alias)),e=d.content),"string"!=typeof e){l++,n.push(r),i.push(e),s.push(0),o.push(e.length);continue}const h=e.split(m),u=h.length;c.push({types:r,content:h[0]});for(let n=1;n<u;n++)x(c),a.push(c=[]),c.push({types:r,content:h[n]})}l--,n.pop(),i.pop(),s.pop(),o.pop()}return x(c),a},f=(e,n)=>{const{plain:i}=e,s=e.styles.reduce(((e,i)=>{const{languages:s,style:o}=i;return s&&!s.includes(n)||i.types.forEach((n=>{const i={...e[n],...o};e[n]=i})),e}),{});return s.root=i,s.plain={...i,backgroundColor:void 0},s};var g=i(85893);const b=f(h.Z,"javascript");t.Z.canUseDOM&&((void 0!==i.g?i.g:window).Prism=d.Z);const y=e=>{let n="";return e.forEach(((e,i)=>{let s=e;e!==window&&(s=r()(e)),n+=`${i+1}:  ${s}\n`})),n},v=e=>{let{key:n,className:i,style:s,line:o,...t}=e;const l={...t,className:"token-line",style:void 0,key:void 0};return void 0!==b&&(l.style=b.plain),void 0!==s&&(l.style=void 0!==l.style?{...l.style,...s}:s),void 0!==n&&(l.key=n),i&&(l.className+=` ${i}`),l},N=e=>{let{types:n,empty:i}=e;const s=n.length;if(void 0===b)return;if(1===s&&"plain"===n[0])return i?{display:"inline-block"}:void 0;if(1===s&&!i)return b[n[0]];const o=i?{display:"inline-block"}:{},t=n.map((e=>b[e]));return Object.assign(o,...t)},w=e=>{let{key:n,className:i,style:s,token:o,...t}=e;const l={...t,className:`token ${o.types.join(" ")}`,children:o.content,style:N(o),key:void 0};return void 0!==s&&(l.style=void 0!==l.style?{...l.style,...s}:s),void 0!==n&&(l.key=n),i&&(l.className+=` ${i}`),l};function A(e){let{children:n="",title:i="",run:t=!0}=e;const[l,a]=(0,s.useState)(n),[r,m]=(0,s.useState)(""),x=()=>{m("");const e=`\n    const __results=[];\n        \n    try{\n      (()=>{\n        ${l}\n      })();\n    }catch(err){\n      return {results: __results, err};\n    }\n      \n    return {results: __results};`.replaceAll("console.log","__results.push");console.log(`var output =  (()=>{\n      ${e}\n    })() `);try{const{results:n,err:i}=new Function(e)();m(y(i?[...n,i]:n))}catch(n){m(y([n]))}};return(0,s.useEffect)((()=>{t&&x()}),[t]),(0,g.jsxs)("section",{className:"js-live-editor margin-bottom--md",children:[(0,g.jsx)("i",{children:i}),(0,g.jsx)("div",{className:"shadow--md thin-scrollbar",children:(0,g.jsx)(c(),{className:"editor",textareaClassName:"codeArea",style:h.Z.plain,padding:10,value:l,onValueChange:e=>a(e),highlight:e=>j(d.Z.tokenize(e,d.Z.languages.javascript,"javascript")).map(((e,n)=>(0,g.jsxs)("div",{...v({line:e}),children:[(0,g.jsx)("span",{className:"editorLineNumber",children:n+1}),e.map(((e,n)=>(0,g.jsx)("span",{...w({token:e})},n)))]},n)))})}),(0,g.jsx)("button",{className:"button button--primary margin-top--md margin-right--xs",onClick:x,children:"Run"}),(0,g.jsx)("button",{className:"button button--secondary margin-top--md",onClick:()=>{a(n),m("")},children:"Reset"}),(0,g.jsx)("div",{className:(0,u.Z)("outputArea","shadow--md","margin-top--md","padding--sm"),children:(0,g.jsx)(o.Z,{fallback:(0,g.jsx)(g.Fragment,{children:" "}),children:()=>(0,g.jsx)(g.Fragment,{children:""===r?" ":r})})})]})}},99507:(e,n,i)=>{"use strict";i.d(n,{Z:()=>c});var s=i(67294);const o={box:"box_hmUj",base:"base_BuAY"};var t=i(85893);function l(e){let{color:n,children:i,...s}=e;return(0,t.jsx)("div",{className:o.box,style:{backgroundColor:n??"LightBlue",...s},children:i})}const c={React:s,...s,Grid:function(e){let{numItems:n=20,children:i,...s}=e;return(0,t.jsxs)("div",{style:{position:"relative",height:"300px",overflowY:"scroll"},children:[(0,t.jsx)("div",{className:o.base,style:{zIndex:10,...s},children:[...Array(n).fill(0)].map(((e,n)=>(0,t.jsx)(l,{color:"#B97A57",children:n},n)))}),(0,t.jsx)("div",{className:o.base,style:{zIndex:20,...s},children:i})]})},Box:l}},69776:(e,n,i)=>{"use strict";i.d(n,{Z:()=>s});const s=i.p+"assets/images/call-site-4d8cf528732593d980abc703ce9fdc4d.png"},48211:(e,n,i)=>{"use strict";i.d(n,{Z:()=>s});const s="data:image/png;base64,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"},48230:(e,n,i)=>{"use strict";i.d(n,{Z:()=>s});const s=i.p+"assets/images/this-execution-context-afcab3c2f8bc829ad42eab1c5541940a.png"},24654:()=>{}}]);